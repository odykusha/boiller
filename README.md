# –ë–æ–π–ª–µ—Ä-–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä üîãüí°

–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –±–æ–π–ª–µ—Ä–æ–º –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç–∞–Ω—É —Å–æ–Ω—è—á–Ω–æ—ó –±–∞—Ç–∞—Ä–µ—ó —Ç–∞ –º–µ—Ä–µ–∂—ñ –µ–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è.

## –û–ø–∏—Å

–¶–µ–π –ø—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–µ—Ä—É—î –±–æ–π–ª–µ—Ä–æ–º —á–µ—Ä–µ–∑ —Ä–æ–∑—É–º–Ω—É —Ä–æ–∑–µ—Ç–∫—É Xiaomi, –±–∞–∑—É—é—á–∏—Å—å –Ω–∞:
- –°—Ç–∞–Ω—ñ –±–∞—Ç–∞—Ä–µ—ó —Å–æ–Ω—è—á–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ (—ñ–Ω–≤–µ—Ä—Ç–æ—Ä Deye)
- –ù–∞—è–≤–Ω–æ—Å—Ç—ñ –º–µ—Ä–µ–∂—ñ –µ–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è
- –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –¥–æ–º—É

–°–∏—Å—Ç–µ–º–∞ –≤–º–∏–∫–∞—î –±–æ–π–ª–µ—Ä —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏:
- ‚úÖ –Ñ –º–µ—Ä–µ–∂–∞ –µ–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è
- ‚úÖ –ë–∞—Ç–∞—Ä–µ—è –∑–∞—Ä—è–¥–∂–µ–Ω–∞ –Ω–∞ 95% –∞–±–æ –±—ñ–ª—å—à–µ
- ‚úÖ –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–º—É –Ω–µ –ø–µ—Ä–µ–≤–∏—â—É—î 2000 –í—Ç

–ë–æ–π–ª–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–º–∏–∫–∞—î—Ç—å—Å—è –∫–æ–ª–∏:
- ‚ùå –ù–µ–º–∞—î –º–µ—Ä–µ–∂—ñ
- ‚ùå –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–º—É –ø–µ—Ä–µ–≤–∏—â—É—î 4000 –í—Ç

## –í–∏–º–æ–≥–∏

- Python 3.12+
- –Ü–Ω–≤–µ—Ä—Ç–æ—Ä Deye –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é Modbus TCP
- –†–æ–∑—É–º–Ω–∞ —Ä–æ–∑–µ—Ç–∫–∞ Xiaomi (ChuangmiPlug)
- –î–æ—Å—Ç—É–ø –¥–æ –ª–æ–∫–∞–ª—å–Ω–æ—ó –º–µ—Ä–µ–∂—ñ –∑ –æ–±–æ–º–∞ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### 0.
—Å–∫–∞—á–∞—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω—É –≤–µ—Ä—Å—ñ—é —Ñ–∞–π–ª—É **token_extractor.py** 

```bash
curl -L -o token_extractor.py https://raw.githubusercontent.com/PiotrMachowski/Xiaomi-cloud-tokens-extractor/master/token_extractor.py
```

### 1. –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

```bash
git clone <repository-url>
cd boiller
```

### 2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è 

```bash
docker compose build check
```

### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `config.json` –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø—Ä–∏–∫–ª–∞–¥—É:

```json
{
    "deye": {
        "ip": "192.168.1.2",
        "serial": 9999999999
    },
    "mijia": {
        "ip": "192.168.1.3",
        "token": "your_token_here"
    }
}
```

**–û—Ç—Ä–∏–º–∞–Ω–Ω—è token –¥–ª—è Xiaomi:**

### 4. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤

–£ —Ñ–∞–π–ª—ñ `boiller.py` –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ—Ä–æ–≥–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è:

```python
SOC_LEVEL = 95          # –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –∑–∞—Ä—è–¥—É –±–∞—Ç–∞—Ä–µ—ó –¥–ª—è –≤–º–∏–∫–∞–Ω–Ω—è –±–æ–π–ª–µ—Ä–∞ (%)
HOME_LOAD = 2000        # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–º—É –¥–ª—è –≤–º–∏–∫–∞–Ω–Ω—è –±–æ–π–ª–µ—Ä–∞ (–í—Ç)
MAX_HOME_LOAD = 4000    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–º—É –ø–µ—Ä–µ–¥ –≤–∏–º–∏–∫–∞–Ω–Ω—è–º (–í—Ç)
```

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ:

```bash
docker compose run --rm token
```

### –ó–∞–ø—É—Å–∫ —è–∫ systemd —Å–µ—Ä–≤—ñ—Å

1. –°–∫–æ–ø—ñ—é–π—Ç–µ `boiller.service` –¥–æ `/etc/systemd/system/`:

```bash
sudo cp boiller.service /etc/systemd/system/
```

2. –í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —à–ª—è—Ö —É —Ñ–∞–π–ª—ñ —Å–µ—Ä–≤—ñ—Å—É (—Ä—è–¥–æ–∫ `WorkingDirectory`)

3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å:

```bash
sudo systemctl daemon-reload
sudo systemctl enable boiller.service
sudo systemctl start boiller.service
```

4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å:

```bash
sudo systemctl status boiller.service
```

5. –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤:

```bash
docker compose logs -f check
```

### –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑ –≥—Ä–∞—Ñ—ñ–∫–∞–º–∏

![](image.png)

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞—î –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –¥–∞–Ω–∏—Ö —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ.

1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä:

```bash
docker compose up -d web
```

2. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä —ñ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ –∞–¥—Ä–µ—Å–æ—é:

```
http://localhost:8080
```

–í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î:
- üìä –ì—Ä–∞—Ñ—ñ–∫–∏ –∑–Ω–∞—á–µ–Ω—å `battery_soc`, `grid_load`, `home_load` —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- üìà –Ü—Å—Ç–æ—Ä—ñ—é –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 1000 –∑–∞–ø–∏—Å—ñ–≤ (–æ—Å—Ç–∞–Ω–Ω—ñ ~16 –≥–æ–¥–∏–Ω)
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 60 —Å–µ–∫—É–Ω–¥
- üì± –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤

–î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Ñ–∞–π–ª—ñ `data_history.json` —ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –ø—Ä–∏ –∫–æ–∂–Ω—ñ–π –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ.

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

–°–∏—Å—Ç–µ–º–∞ –≤–∏–≤–æ–¥–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–∂–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É:
- üïØÔ∏è –ú–µ—Ä–µ–∂—ñ –Ω–µ–º–∞—î - –±–æ–π–ª–µ—Ä –≤–∏–º–∫–Ω–µ–Ω–æ
- üí° –ú–µ—Ä–µ–∂–∞ —î, –±–∞—Ç–∞—Ä–µ—è –∑–∞—Ä—è–¥–∂–µ–Ω–∞ - –±–æ–π–ª–µ—Ä —É–≤—ñ–º–∫–Ω–µ–Ω–æ
- ‚è≥ –ú–µ—Ä–µ–∂–∞ —î, —á–µ–∫–∞—î–º–æ –∑–∞—Ä—è–¥–∂–µ–Ω–Ω—è –±–∞—Ç–∞—Ä–µ—ó
- ‚ùå –ü–æ–º–∏–ª–∫–∏ –ø—ñ–¥ —á–∞—Å —Ä–æ–±–æ—Ç–∏

–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 60 —Å–µ–∫—É–Ω–¥.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
boiller/
‚îú‚îÄ‚îÄ boiller.py           # –û—Å–Ω–æ–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –∫–µ—Ä—É–≤–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ web_server.py        # –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∑ API —Ç–∞ –≥—Ä–∞—Ñ—ñ–∫–∞–º–∏
‚îú‚îÄ‚îÄ data_storage.py     # –ú–æ–¥—É–ª—å –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó –¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ index.html      # –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑ –≥—Ä–∞—Ñ—ñ–∫–∞–º–∏
‚îú‚îÄ‚îÄ data_history.json   # –Ü—Å—Ç–æ—Ä—ñ—è –¥–∞–Ω–∏—Ö (—Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)
‚îú‚îÄ‚îÄ config.json         # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (–Ω–µ –≤–∫–ª—é—á–µ–Ω–æ –≤ git)
‚îú‚îÄ‚îÄ token_extractor.py  # –£—Ç–∏–ª—ñ—Ç–∞ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è token Xiaomi
‚îú‚îÄ‚îÄ Dockerfile          # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml  # Docker Compose –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ boiller.service     # Systemd —Å–µ—Ä–≤—ñ—Å
‚îî‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
```


## –ê–≤—Ç–æ—Ä

[odykusha]
